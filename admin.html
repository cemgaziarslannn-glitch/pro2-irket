<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ğŸ‘‘ Admin Panel | Denetici YÃ¶netimi</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
 margin:0;
 padding:30px;
 background:#050914;
 font-family:'Segoe UI',system-ui;
 color:#fff;
 display:none; /* Sayfa gizli baÅŸta */
}
h2{
 color:#00e5ff;
 margin:30px 0 15px;
}
.user{
 background:linear-gradient(135deg,#1b2445,#202c5a);
 padding:18px;
 border-radius:18px;
 margin-bottom:14px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 box-shadow:0 20px 40px rgba(0,0,0,.5);
}
.info{line-height:1.5}
.info b{font-size:15px}
.info span{font-size:13px;opacity:.8}

.actions button{
 margin-left:8px;
 padding:10px 16px;
 border:none;
 border-radius:14px;
 font-weight:800;
 cursor:pointer;
}

.approve{background:linear-gradient(135deg,#00e5ff,#6a5cff)}
.delete{background:linear-gradient(135deg,#ff3c3c,#ff0066)}
/* â‹ MENÃœ BUTONU */
.menu-exit-btn{
 position:fixed;         /* Ekrana sabitler */
 top:12px;               /* Ãœstten 12px boÅŸluk */
 right:12px;             /* SaÄŸdan 12px boÅŸluk */
 z-index:9999;           /* Her ÅŸeyin Ã¼stÃ¼nde gÃ¶rÃ¼nÃ¼r */
 padding:8px 12px;       /* Ä°Ã§ boÅŸluk */
 border-radius:12px;     /* KÃ¶ÅŸeleri yuvarlatÄ±r */
 font-size:13px;         /* YazÄ± boyutu */
 background:linear-gradient(135deg,#ff4d4d,#b30000); /* Arkaplan rengi */
 color:#fff;             /* YazÄ± rengi */
 border:none;            /* Ã‡erÃ§eve yok */
 box-shadow:0 6px 18px rgba(255,0,0,.5); /* Hafif gÃ¶lge */
 cursor:pointer;         /* Fare Ã¼zerine gelince pointer */
}

</style>
</head>

<body>
<button class="menu-exit-btn" onclick="goMenu()">â‹</button>

<h2>ğŸ•’ Onay Bekleyen DenetÃ§iler</h2>
<div id="pending"></div>

<h2>ğŸ›¡ï¸ Mevcut DenetÃ§iler</h2>
<div id="approved"></div>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyCye0QlekBFonTxfeBIlhLc9ia-mleyfUM",
 authDomain: "denetleme-4d3d9.firebaseapp.com",
 databaseURL: "https://denetleme-4d3d9-default-rtdb.firebaseio.com",
 projectId: "denetleme-4d3d9",
 storageBucket: "denetleme-4d3d9.appspot.com",
 messagingSenderId: "584625735764",
 appId: "1:584625735764:web:5889dcaadb69c4c78f45c1"
});

const db = firebase.database();
const auth = firebase.auth();

// === AUTH KORUMASI ===
auth.onAuthStateChanged(user => {
  if(!user){
    alert("GiriÅŸ yapmanÄ±z gerekiyor");
    location.replace("login.html");
  } else {
    db.ref("users/"+user.uid).once("value").then(snap => {
      if(!snap.exists() || !snap.val().approved){
        alert("Admin onayÄ± bekleniyor");
        auth.signOut();
        location.replace("login.html");
        return;
      }

      // Opsiyonel: rol kontrolÃ¼
      const role = snap.val().role;
      if(role !== "admin" && role !== "mÃ¼dÃ¼r"){
        alert("Bu sayfayÄ± gÃ¶rÃ¼ntÃ¼leme yetkiniz yok");
        auth.signOut();
        location.replace("login.html");
        return;
      }

      // Yetkili kullanÄ±cÄ±, sayfayÄ± gÃ¶ster
      document.body.style.display = "block";
    });
  }
});

/* ğŸ”µ ONAY BEKLEYENLER (SADECE DENETÃ‡Ä°LER) */
db.ref("users")
.orderByChild("approved")
.equalTo(false)
.on("value", snap => {
 const box = document.getElementById("pending");
 box.innerHTML = "";

 if(!snap.exists()){
  box.innerHTML = "<p>ğŸ‰ Onay bekleyen yok</p>";
  return;
 }

 snap.forEach(u=>{
  const d = u.val();
  if(d.role !== "denetici") return;

  box.innerHTML += `
   <div class="user">
    <div class="info">
     <b>${d.fullName||"Ä°simsiz"}</b><br>
     <span>${d.email||"E-posta yok"}</span>
    </div>
    <div class="actions">
     <button class="approve" onclick="approve('${u.key}')">âœ… Onayla</button>
     <button class="delete" onclick="removeUser('${u.key}')">âŒ Sil</button>
    </div>
   </div>
  `;
 });
});

/* ğŸŸ¢ MEVCUT DENETÃ‡Ä°LER (SADECE ONAYLI DENETÃ‡Ä°LER) */
db.ref("users")
.orderByChild("role")
.equalTo("denetici")
.on("value", snap => {
 const box = document.getElementById("approved");
 box.innerHTML = "";

 if(!snap.exists()){
  box.innerHTML = "<p>HenÃ¼z denetici yok</p>";
  return;
 }

 let bulundu = false;
 snap.forEach(u => {
  const d = u.val();
  if(d.approved !== true) return;  

  bulundu = true;
  box.innerHTML += `
   <div class="user">
    <div class="info">
     <b>${d.fullName}</b><br>
     <span>${d.email}</span>
    </div>
    <div class="actions">
     <button class="delete" onclick="removeUser('${u.key}')">âŒ Sil</button>
    </div>
   </div>
  `;
 });

 if(!bulundu){
  box.innerHTML = "<p>OnaylÄ± denetici yok</p>";
 }
});

/* ğŸ”§ Ä°ÅLEVLER */
function approve(uid){
 if(!confirm("KullanÄ±cÄ± denetici olarak onaylansÄ±n mÄ±?")) return;
 db.ref("users/"+uid).update({
  approved:true,
  role:"denetici",
  approvedAt:Date.now()
 });
}

function removeUser(uid){
 if(!confirm("âš ï¸ Bu kullanÄ±cÄ± TAMAMEN silinecek. Devam?")) return;
 db.ref("users/"+uid).remove().then(()=>{
  alert("ğŸ—‘ï¸ KullanÄ±cÄ± sistemden tamamen silindi");
 });
}
// MENÃœ BUTONU
function goMenu(){
  window.location.href="menÃ¼.html";
}
</script>

</body>
</html>
