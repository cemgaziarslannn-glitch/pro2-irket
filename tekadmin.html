<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ğŸ‘‘ Admin Panel | KullanÄ±cÄ± YÃ¶netimi</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase SDK'larÄ± -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
 margin:0;
 padding:30px;
 background:#050914;
 font-family:'Segoe UI',system-ui;
 color:#fff;
 display:none; /* âš  Sayfa iÃ§erik baÅŸlangÄ±Ã§ta gizli */
}

h2{
 color:#00e5ff;
 margin:30px 0 15px;
}

.user{
 background:linear-gradient(135deg,#1b2445,#202c5a);
 padding:18px;
 border-radius:18px;
 margin-bottom:14px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 box-shadow:0 20px 40px rgba(0,0,0,.5);
}

.info{line-height:1.5}
.info b{font-size:15px}
.info span{font-size:13px;opacity:.8}

.actions button{
 margin-left:8px;
 padding:10px 16px;
 border:none;
 border-radius:14px;
 font-weight:800;
 cursor:pointer;
}

.approve{background:linear-gradient(135deg,#00e5ff,#6a5cff)}
.delete{background:linear-gradient(135deg,#ff3c3c,#ff0066)}

.role-denetici{color:#22c55e; font-weight:700}
.role-mudur{color:#ffd700; font-weight:700}
/* â‹ MENÃœ BUTONU â€” MODAL Ä°Ã‡Ä°N UYUMLU */
.menu-exit-btn{
  /* position:fixed;  âš  kaldÄ±rÄ±ldÄ± */
  /* top:16px; right:16px; âš  kaldÄ±rÄ±ldÄ± */
  z-index:10000;
  padding:10px 14px;
  border-radius:14px;
  font-size:14px;
  background:linear-gradient(135deg,#ff4d4d,#b30000); /* default renk */
  color:#fff;
  border:none;
  box-shadow:0 6px 20px rgba(255,0,0,0.55);
  cursor:pointer;
  transition:transform 0.2s, box-shadow 0.2s;
}

.menu-exit-btn:hover{
  transform:scale(1.08);
  box-shadow:0 8px 24px rgba(255,0,0,0.65);
}

/* Hover efekti */
.menu-exit-btn:hover{
  transform:scale(1.08);
  box-shadow:0 8px 24px rgba(255,0,0,0.65);
}

</style>
</head>
<body>
<!-- Ã‡Ä±kÄ±ÅŸ onay modalÄ± -->
<div id="logoutModal" style="
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  justify-content:center;
  align-items:center;
  z-index:9999;
">
  <div style="
    background:#0b1a27;
    padding:24px 30px;
    border-radius:16px;
    text-align:center;
    color:#fff;
    max-width:320px;
    width:90%;
  ">
    <p style="margin-bottom:20px; font-weight:600;">Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinizden emin misiniz?</p>
    <button onclick="confirmLogout()" style="
      padding:10px 20px;
      margin-right:12px;
      border:none;
      border-radius:12px;
      background:#1abc9c;
      color:#000;
      font-weight:700;
      cursor:pointer;
    ">Evet</button>
    <button onclick="cancelLogout()" style="
      padding:10px 20px;
      border:none;
      border-radius:12px;
      background:#ff3c3c;
      color:#fff;
      font-weight:700;
      cursor:pointer;
    ">HayÄ±r</button>
  </div>
</div>
<!-- MENÃœ BUTONLARI -->
<div style="position:fixed; top:16px; right:16px; display:flex; gap:10px; z-index:10000;">
  <button class="menu-exit-btn" onclick="showLogoutModal()">â‹ Ã‡Ä±kÄ±ÅŸ</button>
  <button class="menu-exit-btn" style="background:linear-gradient(135deg,#22c55e,#0d8f3c);" onclick="goDepo()">ğŸ“¦ Depo</button>
</div>

<script>
// Depo sayfasÄ±na yÃ¶nlendirme
function goDepo(){
  window.location.href = "depo.html";
}
</script>



<h2>ğŸ•’ Onay Bekleyen KullanÄ±cÄ±lar</h2>
<div id="pending"></div>

<h2>ğŸ›¡ï¸ Mevcut KullanÄ±cÄ±lar</h2>
<div id="approved"></div>

<script>
// Firebase yapÄ±landÄ±rma
firebase.initializeApp({
 apiKey: "AIzaSyCye0QlekBFonTxfeBIlhLc9ia-mleyfUM",
 authDomain: "denetleme-4d3d9.firebaseapp.com",
 databaseURL: "https://denetleme-4d3d9-default-rtdb.firebaseio.com",
 projectId: "denetleme-4d3d9",
 storageBucket: "denetleme-4d3d9.appspot.com",
 messagingSenderId: "584625735764",
 appId: "1:584625735764:web:5889dcaadb69c4c78f45c1"
});

const auth = firebase.auth();
const db = firebase.database();

// ğŸ” Sayfa eriÅŸim kontrolÃ¼: hemen yÃ¶nlendir
auth.onAuthStateChanged(user => {
    if (!user) {
        // Login yoksa direkt login sayfasÄ±na git
        window.location.href = "index.html"; // Kendi login URLâ€™in ile deÄŸiÅŸtir
    } else {
        // Login varsa sayfayÄ± gÃ¶ster
        document.body.style.display = "block";
        console.log("GiriÅŸ yapmÄ±ÅŸ kullanÄ±cÄ±:", user.email);
        initPage();
    }
});

function initPage() {
    /* ğŸ”µ ONAY BEKLEYENLER */
    db.ref("users")
    .orderByChild("approved")
    .equalTo(false)
    .on("value", snap => {
     const box = document.getElementById("pending");
     box.innerHTML = "";

     if(!snap.exists()){
      box.innerHTML = "<p>ğŸ‰ Onay bekleyen yok</p>";
      return;
     }

     snap.forEach(u => {
      const d = u.val();
      const roleClass = d.role === "mÃ¼dÃ¼r" ? "role-mudur" : "role-denetici";
      const roleLabel = d.role === "mÃ¼dÃ¼r" ? "ğŸ‘‘ MÃ¼dÃ¼r" : "ğŸ›¡ï¸ Denetici";

      box.innerHTML += `
       <div class="user">
        <div class="info">
         <b>${d.fullName || "Ä°simsiz"}</b> <span class="${roleClass}">(${roleLabel})</span><br>
         <span>${d.email || "E-posta yok"}</span>
        </div>
        <div class="actions">
         <button class="approve" onclick="approve('${u.key}', '${d.role}')">âœ… Onayla</button>
         <button class="delete" onclick="removeUser('${u.key}')">âŒ Sil</button>
        </div>
       </div>
      `;
     });
    });

    /* ğŸŸ¢ MEVCUT KULLANICILAR */
    db.ref("users")
    .on("value", snap => {
     const box = document.getElementById("approved");
     box.innerHTML = "";

     if(!snap.exists()){
      box.innerHTML = "<p>HenÃ¼z kullanÄ±cÄ± yok</p>";
      return;
     }

     let bulundu = false;

     snap.forEach(u => {
      const d = u.val();
      if(d.approved !== true) return;

      const roleClass = d.role === "mÃ¼dÃ¼r" ? "role-mudur" : "role-denetici";
      const roleLabel = d.role === "mÃ¼dÃ¼r" ? "ğŸ‘‘ MÃ¼dÃ¼r" : "ğŸ›¡ï¸ Denetici";

      bulundu = true;

      box.innerHTML += `
       <div class="user">
        <div class="info">
         <b>${d.fullName}</b> <span class="${roleClass}">(${roleLabel})</span><br>
         <span>${d.email}</span>
        </div>
        <div class="actions">
         <button class="delete" onclick="removeUser('${u.key}')">âŒ Sil</button>
        </div>
       </div>
      `;
     });

     if(!bulundu){
      box.innerHTML = "<p>OnaylÄ± kullanÄ±cÄ± yok</p>";
     }
    });

}
// MENÃœ BUTONU
function goMenu(){
  window.location.href="menÃ¼.html";
}

// ğŸ”§ Ä°ÅLEVLER
function approve(uid, role){
 if(!confirm("KullanÄ±cÄ± onaylansÄ±n mÄ±?")) return;
 db.ref("users/"+uid).update({
  approved:true,
  role:role,
  approvedAt:Date.now()
 });
}

function removeUser(uid){
 if(!confirm("âš ï¸ Bu kullanÄ±cÄ± TAMAMEN silinecek. Devam?")) return;
 db.ref("users/"+uid).remove().then(()=>{
  alert("ğŸ—‘ï¸ KullanÄ±cÄ± sistemden tamamen silindi");
 });
}
// Modal gÃ¶ster/gizle
function showLogoutModal(){
  document.getElementById("logoutModal").style.display = "flex";
}

function cancelLogout(){
  document.getElementById("logoutModal").style.display = "none";
}

// Firebase Ã§Ä±kÄ±ÅŸ
function confirmLogout(){
  firebase.auth().signOut().then(()=>{
    document.getElementById("logoutModal").style.display = "none"; // modal gizle
    document.body.style.display = "none"; // uygulama iÃ§i UI gizle
    console.log("ğŸ”’ Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±");
    // Ä°stersen burada uygulama iÃ§i login div gÃ¶sterilebilir
  }).catch(err=>{
    console.error("Ã‡Ä±kÄ±ÅŸ yapÄ±lamadÄ±:", err);
  });
}

</script>

</body>
</html>
